{
    "parameters": {
	      "vmSize": {
	      "type": "string",
	      "defaultValue": "standard_F2",
	      "metadata": {
		        "description": "The size of the Batch nodes"
	    	}
	  },
        "dedicatedNodeCount": {
            "type": "int",
	          "defaultValue": 0,
            "metadata": {
                "description": "The number of dedicated pool nodes"
            }
        },
	      "lowPriNodeCount": {
            "type": "int",
            "defaultValue": 4,
            "metadata": {
                "description": "The number of Low Priority pool nodes"
            }
        },
      	"maxTasksPerNode": {
      	    "type": "int",
      	    "defaultValue": 4,
      	    "metadata": {
      		      "description": "The number of tasks that will be assigned to each compute node"
      	    }
      	},
        "poolId": {
            "type": "string",
	          "defaultValue": "EnergyPlus_Pool--Final",
            "metadata": {
                "description": "The name of the pool being created"
            }
        },
        "blobSource": {
            "type": "string",
            "defaultValue": "https://utcnorescobatchsa.blob.core.windows.net/installation/node-setup.sh",
            "metadata": {
                "description": "The node setup script task that will be downloaded & run on all nodes joining the pool"
            }
        }
    },
    "pool": {
        "type": "Microsoft.Batch/batchAccounts/pools",
        "properties": {
            "id": "[parameters('poolId')]",
            "virtualMachineConfiguration": {
                "imageReference": {
                    "publisher": "Canonical",
                    "offer": "UbuntuServer",
                    "sku": "14.04.5-LTS",
                    "version": "latest"
                },
                "nodeAgentSKUId": "batch.node.ubuntu 14.04"
            },
            "vmSize": "[parameters('vmSize')]",
            "targetDedicatedNodes": "[parameters('dedicatedNodeCount')]",
            "targetLowPriorityNodes": "[parameters('lowPriNodeCount')]",
	        "nodeFillType": "spread",
            "enableAutoScale": false,
            "maxTasksPerNode": "[parameters('maxTasksPerNode')]",
            "interNodeCommunication": false,
            "startTask": {
                "commandLine": "/bin/bash -c '/mnt/batch/tasks/startup/node-setup.sh'",
                "resourceFiles": [
                    {
                    "blobSource": "[parameters('blobSource')]",
                    "filePath": "/mnt/batch/tasks/startup/node-setup.sh",
                    "fileMode": "777"
                    }
                ],
                "environmentSettings": [
                    {
                        "name": "APP_INSIGHTS_APP_ID",
                        "value": "1a951d15-63a2-483b-955a-b537211c1f98"
                      },
                      {
                        "name": "APP_INSIGHTS_INSTRUMENTATION_KEY",
                        "value": "4630f102-4e0d-4cf3-b401-e6e41a1db351"
                      }
                ],
                "userIdentity": {
                "autoUser": {
                    "scope": "pool",
                    "elevationLevel": "admin"
                    }
                },
                "maxTaskRetryCount": 0,
                "waitForSuccess": true
            }
        }
    } 
}
